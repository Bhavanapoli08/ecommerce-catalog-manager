#!/bin/bash

echo "🚀 Setting up eCommerce Catalog Tool..."

# Start database
echo "📦 Starting PostgreSQL database..."
docker-compose up -d

# Wait for database to be ready
echo "⏳ Waiting for database to be ready..."
sleep 5

# Setup backend
echo "🔧 Setting up backend..."
cd backend
npm install
npx prisma generate
npx prisma migrate deploy
npx prisma db seed

# Start backend in background
echo "🖥️  Starting backend server..."
npm run start:dev &
BACKEND_PID=$!

# Setup frontend
echo "🎨 Setting up frontend..."
cd ../frontend
npm install

# Start frontend in background  
echo "🌐 Starting frontend server..."
npm run dev &
FRONTEND_PID=$!

echo "✅ Setup complete!"
echo ""
echo "🔗 Access points:"
echo "   Frontend: http://localhost:5173"
echo "   Backend API: http://localhost:3000"
echo "   API Docs: http://localhost:3000/api"
echo ""
echo "Press Ctrl+C to stop all servers"

# Wait for interrupt
trap "kill $BACKEND_PID $FRONTEND_PID; exit" INT
wait
