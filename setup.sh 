#!/bin/bash

echo "ğŸš€ Setting up eCommerce Catalog Tool..."

# Start database
echo "ğŸ“¦ Starting PostgreSQL database..."
docker-compose up -d

# Wait for database to be ready
echo "â³ Waiting for database to be ready..."
sleep 5

# Setup backend
echo "ğŸ”§ Setting up backend..."
cd backend
npm install
npx prisma generate
npx prisma migrate deploy
npx prisma db seed

# Start backend in background
echo "ğŸ–¥ï¸  Starting backend server..."
npm run start:dev &
BACKEND_PID=$!

# Setup frontend
echo "ğŸ¨ Setting up frontend..."
cd ../frontend
npm install

# Start frontend in background  
echo "ğŸŒ Starting frontend server..."
npm run dev &
FRONTEND_PID=$!

echo "âœ… Setup complete!"
echo ""
echo "ğŸ”— Access points:"
echo "   Frontend: http://localhost:5173"
echo "   Backend API: http://localhost:3000"
echo "   API Docs: http://localhost:3000/api"
echo ""
echo "Press Ctrl+C to stop all servers"

# Wait for interrupt
trap "kill $BACKEND_PID $FRONTEND_PID; exit" INT
wait
